<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda de Espacios</title>
    <link href="css/agenda.css" rel="stylesheet">
</head>
<body>
    <div class="agenda-container">
        <h2 class="agenda-title">
            Agenda de Ocupaci贸n de Espacios - 
            <span th:text="${agenda.nameMonth}"></span> 
            <span th:text="${agenda.year}"></span>
        </h2>

        <!-- Leyenda de colores -->
        <div class="agenda-leyenda">
            <h3>Leyenda</h3>
            <div class="leyenda-items">
                <div class="leyenda-item">
                    <div class="leyenda-color available"></div>
                    <span>Disponible</span>
                </div>
                <div class="leyenda-item">
                    <div class="leyenda-color occupied"></div>
                    <span>Ocupado</span>
                </div>
                <div class="leyenda-item">
                    <div class="leyenda-color blocked"></div>
                    <span>Bloqueado</span>
                </div>
            </div>
        </div>

        <!-- Filtro de semanas -->
        <div class="agenda-filtros">
            <label for="filtroSemanas">Mostrar solo semanas con ocupaci贸n:</label>
            <input type="checkbox" id="filtroSemanas" onchange="filtrarSemanas()">
        </div>

        <!-- Botones para cambiar de sala -->
        <div class="agenda-nav">
            <button class="agenda-btn" th:each="sala : ${salas}" 
                    th:data-id="'sala-' + ${sala.roomName}"
                    th:text="${sala.roomName}">
            </button>
        </div>

        <!-- Contenido de cada sala (solo una se muestra a la vez) -->
        <div class="agenda-content">
            <div th:each="sala : ${salas}" 
                 class="agenda-sala"
                 th:id="'sala-' + ${sala.roomName}"
                 th:style="${salaStat.first} ? 'display: block;' : 'display: none;'">

                <h3 th:text="${sala.roomName}" class="agenda-sala-title"></h3>

                <!-- Tabla de horarios por semanas -->
                <div class="agenda-table-wrapper" th:each="semana : ${sala.weekMonth}">
                    <h4 th:text="'Semana ' + ${semana.weekNumber}"></h4>
                    <table class="agenda-table">
                        <thead>
                            <tr>
                                <th>Hora</th>
                                <th class="agenda-day" th:each="dia : ${diasSemana}" th:text="${dia}"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="agenda-hour" th:each="hora : ${horas}">
                                <td th:text="${hora}"></td>
                                <td th:each="dia, diaStat : ${diasSemana}">
                                    <div th:each="diaModel : ${semana.days}" 
                                         th:if="${diaModel.dayOfWeek == diaStat.count}">
                                        <div th:each="celda : ${diaModel.cells}" 
                                             th:if="${celda.hour == hora}"
                                             th:class="${celda.status.toLowerCase()}"
                                             th:text="${celda.activity}">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Secci贸n de incidencias mejorada -->
        <div class="agenda-incidencias" th:if="${not #lists.isEmpty(agenda.incidences)}">
            <h3 class="agenda-incidencias-title">Incidencias Detectadas</h3>
            <div class="incidencias-container">
                <div class="incidencia-item" th:each="incidencia : ${agenda.incidences}">
                    <div class="incidencia-header">
                        <span class="incidencia-tipo" th:text="${incidencia.type}"></span>
                        <span class="incidencia-fecha" th:text="${incidencia.date}"></span>
                    </div>
                    <p class="incidencia-descripcion" th:text="${incidencia.description}"></p>
                    <div class="incidencia-detalles" th:if="${incidencia.details != null}">
                        <p th:text="${incidencia.details}"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bot贸n para volver -->
        <div class="agenda-actions">
            <a href="/upload" class="btn-volver">Volver a subir archivos</a>
        </div>
    </div>
    <script src="js/agenda.js"></script>
</body>
</html>
